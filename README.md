# Local ECS

https://www.elastic.co/docs/reference/ecs/logging/go-logrus/setup    
https://pkg.go.dev/gopkg.in/go-extras/elogrus.v7@v7.3.0  


## Local Elasticsearch

https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-elasticsearch-docker-basic#_start_a_single_node_cluster  

```sh
docker network create elastic
```

```sh
docker run -d --name es01 --net elastic -p 9200:9200 -it -m 1GB docker.elastic.co/elasticsearch/elasticsearch:9.2.4
```

```sh
docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic
```

```sh
docker cp es01:/usr/share/elasticsearch/config/certs/http_ca.crt .
```

```sh
docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana
```

```sh
docker run -d --name kib01 --net elastic -p 5601:5601 docker.elastic.co/kibana/kibana:9.2.4
```

## ERROR: Elasticsearch died while starting up, with exit code 78
https://community.sonarsource.com/t/cant-start-docker-container-due-to-elasticsearch-bootstrap-error/132921

I updated etc/sysctl.conf to add this line:

vm.max_map_count=262144

The ran this to update:

sudo sysctl --system

All good after that.

## Test elasticsearch
The default username is `elastic`.  

```sh
ubuntu@ubuntu:~$ docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic
WARNING: Owner of file [/usr/share/elasticsearch/config/users] used to be [root], but now is [elasticsearch]
WARNING: Owner of file [/usr/share/elasticsearch/config/users_roles] used to be [root], but now is [elasticsearch]
This tool will reset the password of the [elastic] user to an autogenerated value.
The password will be printed in the console.
Please confirm that you would like to continue [y/N]y


Password for the [elastic] user successfully reset.
New value: xSdhglJ_4ohN1IpByxtv

ubuntu@ubuntu:~$ curl --cacert http_ca.crt -u elastic:xSdhglJ_4ohN1IpByxtv https://localhost:9200
{
  "name" : "4d5c0267d7ac",
  "cluster_name" : "docker-cluster",
  "cluster_uuid" : "VhXrc330R6aSGeTX_2f5YA",
  "version" : {
    "number" : "9.2.4",
    "build_flavor" : "default",
    "build_type" : "docker",
    "build_hash" : "dfc5c38614c29a598e132c035b66160d3d350894",
    "build_date" : "2026-01-08T22:07:25.170027027Z",
    "build_snapshot" : false,
    "lucene_version" : "10.3.2",
    "minimum_wire_compatibility_version" : "8.19.0",
    "minimum_index_compatibility_version" : "8.0.0"
  },
  "tagline" : "You Know, for Search"
}
```

```sh
ubuntu@ubuntu:~$ docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana
eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTcyLjE4LjAuMjo5MjAwIl0sImZnciI6Ijc4NjZlYWEzOTcyNjk0Y2RmNWNiM2FkMTA2N2E0MDJjZGVlOTNhYmJmYWIzNmU1YmNlZWU5MTFkZjJkYzQ4MzciLCJrZXkiOiJTQmZhdXBzQjNmYjJVSkR2SXpLYTpqNHpKWm01MFRqZXdqUWFBMDB3Sjd3In0=
```

## Kibana Dev Tools

```KQL
# Delete my document
DELETE IndexName/DocType/DocId

# Delete all by index name mylog
POST /mylog/_delete_by_query
{
  "query": {
    "match_all": {}
  }
}
```

## Hiding fields in Summary of Kibana

Try this first, per Data View:  
https://www.elastic.co/docs/explore-analyze/discover/discover-get-started  

This is for global setting:  
To hide the
_id field in Kibana's Discover table, you need to adjust the advanced settings within the UI. 
Steps to Hide the _id Field

    Navigate to Management: From the main Kibana menu, go to Stack Management (or just "Management" in older versions).
    Open Advanced Settings: Under the "Kibana" section, select Advanced Settings.
    Locate the MetaFields setting: Search for the setting named metaFields (or meta:fields in some older versions).
    Edit the list: This setting lists fields that exist outside of the _source and are merged into the document when displayed. The default value typically includes _source, _id, _type, _index, and _score.
    Remove _id: Edit the list and remove _id from the comma-separated values.
    Save Changes: Click the Save or Save changes button to apply the modification. 

After saving, the _id field should no longer appear as a column in the Discover tab's main table view.


## References

https://last9.io/blog/understanding-logrus/  
